<!doctype html>
<html lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
        :root {
            --accent-color: #FF4D4D;
        }
    </style>

         

    
    <title>981. Time Based Key-Value Store - LeetCode</title>
    <meta name="description" content="981. Time Based Key-Value Store - LeetCode" />
    <meta name="keywords" content='blog, hugo, leetcode, python, binarySearch, medium' />

    <meta property="og:url" content="http://localhost:1313/posts/981.timebasedkey-valuestore/" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="981. Time Based Key-Value Store - LeetCode" />
    <meta property="og:description" content="981. Time Based Key-Value Store - LeetCode" />
    <meta property="og:image" content="http://localhost:1313/path/to/image.png" />
    <meta property="og:image:secure_url" content="http://localhost:1313/path/to/image.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="981. Time Based Key-Value Store - LeetCode" />
    <meta name="twitter:description" content="981. Time Based Key-Value Store - LeetCode" />
    <meta property="twitter:domain" content="http://localhost:1313/posts/981.timebasedkey-valuestore/" />
    <meta property="twitter:url" content="http://localhost:1313/posts/981.timebasedkey-valuestore/" />
    <meta name="twitter:image" content="http://localhost:1313/path/to/image.png" />

    
    <link rel="canonical" href="http://localhost:1313/posts/981.timebasedkey-valuestore/" />

    
    <link
        rel="stylesheet"
        type="text/css"
        href="/css/normalize.min.css"
        media="print"
    />

    
    <link rel="stylesheet" type="text/css" href="/css/main.min.css" />

    
    <link id="dark-theme" rel="stylesheet" href="/css/dark.min.css" />

    
    <script
        src="/js/bundle.min.9a920d7dabdbad8363b6a0a94e29a9dfebdb7ee64cfcb193a0145e512ef2bdab.js"
        integrity="sha256-mpINfavbrYNjtqCpTimp3&#43;vbfuZM/LGToBReUS7yvas="
    ></script>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
    
</head>
<head>
        ... 
        ...
    </head>
    <body>
        <script>
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="http://localhost:1313/">
                <img src='/images/avatar.png' alt="avatar">
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="http://localhost:1313/">Denis Razsolkov</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="http://localhost:1313/posts/"> Posts </a>
            </div>
            
            <div class="nav-link">
                <a href="http://localhost:1313/cv/"> CV </a>
            </div>
            
            <div class="nav-link">
                <a href="http://localhost:1313/tags/"> Tags </a>
            </div>
            
            <div class="nav-link">
                <a href="https://github.com/drazsolkov"><span data-feather='github'></span>  </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span class="sr-only dark-theme-toggle-screen-reader-target"></span>
                <a>
                    <span class="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="http://localhost:1313/posts/"> Posts </a>
                </li>
                
                <li class="nav-item">
                    <a href="http://localhost:1313/cv/"> CV </a>
                </li>
                
                <li class="nav-item">
                    <a href="http://localhost:1313/tags/"> Tags </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://github.com/drazsolkov"><span data-feather='github'></span>  </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
                    <a>
                        <span class="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>981. Time Based Key-Value Store - LeetCode</h1>
        <small role="doc-subtitle">981. Time Based Key-Value Store - LeetCode</small>
        <p class="post-date">March 5, 2025
        
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="http://localhost:1313/tags/blog">blog</a></li>
        
            <li class="post-tag"><a href="http://localhost:1313/tags/leetcode">leetcode</a></li>
        
            <li class="post-tag"><a href="http://localhost:1313/tags/python">python</a></li>
        
            <li class="post-tag"><a href="http://localhost:1313/tags/binarysearch">binarySearch</a></li>
        
            <li class="post-tag"><a href="http://localhost:1313/tags/medium">medium</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <h2 id="problem-description">Problem Description</h2>
<p>Design a time-based key-value data structure that can store multiple values for the same key at different time stamps and retrieve the key&rsquo;s value at a certain timestamp.</p>
<p>Implement the <code>TimeMap</code> class:</p>
<p><code>TimeMap()</code> Initializes the object of the data structure.
<code>void set(String key, String value, int timestamp</code>) Stores the key <code>key</code> with the value <code>value</code> at the given time <code>timestamp</code>.
<code>String get(String key, int timestamp)</code> Returns a value such that <code>set</code> was called previously, with <code>timestamp_prev &lt;= timestamp</code>. If there are multiple such values, it returns the value associated with the largest <code>timestamp_prev</code>. If there are no values, it returns <code>&quot;&quot;</code>.</p>
<h3 id="example-1">Example 1:</h3>
<ul>
<li><strong>Input:</strong> <code>[&quot;TimeMap&quot;, &quot;set&quot;, &quot;get&quot;, &quot;get&quot;, &quot;set&quot;, &quot;get&quot;, &quot;get&quot;][[], [&quot;foo&quot;, &quot;bar&quot;, 1], [&quot;foo&quot;, 1], [&quot;foo&quot;, 3], [&quot;foo&quot;, &quot;bar2&quot;, 4], [&quot;foo&quot;, 4], [&quot;foo&quot;, 5]]</code></li>
<li><strong>Output:</strong> <code>[null, null, &quot;bar&quot;, &quot;bar&quot;, null, &quot;bar2&quot;, &quot;bar2&quot;]</code></li>
<li><strong>Explanation:</strong></li>
</ul>
<pre tabindex="0"><code>TimeMap timeMap = new TimeMap();
timeMap.set(&#34;foo&#34;, &#34;bar&#34;, 1);  // store the key &#34;foo&#34; and value &#34;bar&#34; along with
timestamp = 1.
timeMap.get(&#34;foo&#34;, 1);         // return &#34;bar&#34;
timeMap.get(&#34;foo&#34;, 3);         // return &#34;bar&#34;, since there is no value
corresponding to foo at timestamp 3 and timestamp 2, then the only value is
at timestamp 1 is &#34;bar&#34;.
timeMap.set(&#34;foo&#34;, &#34;bar2&#34;, 4); // store the key &#34;foo&#34; and value &#34;bar2&#34; along with
timestamp = 4.
timeMap.get(&#34;foo&#34;, 4);         // return &#34;bar2&#34;
timeMap.get(&#34;foo&#34;, 5);         // return &#34;bar2&#34;
</code></pre><h2 id="my-idea">My Idea</h2>
<p>With this data structure it is important to implement an efficient get method. To do this we utilize binary search. The <code>key</code>, <code>value</code> and <code>timestamp</code> are stored in a dictionary where <code>key</code> is the key and the <code>(timestamp,value)</code> tuple is the value. Since we might be calling the <code>get</code> method with a <code>timestamp</code> that is between two values and we want to return the highest lower one, we take advantage of the fact that the right pointer of the binary search always points at exactly this element if the <code>target</code> is not part of the array itself. The only other modification is covering the cases that <code>get</code> was called with a <code>key</code> that is not part of the <code>TimeMap</code> or a <code>timestamp</code> that is lower than the lowest one stored.</p>
<h2 id="my-solution">My solution</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TimeMap</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>storage <span style="color:#f92672">=</span> dict()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set</span>(self, key: str, value: str, timestamp: int) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>storage:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>storage[key]<span style="color:#f92672">.</span>append((timestamp,value))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>storage[key]<span style="color:#f92672">=</span>[(timestamp,value)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get</span>(self, key: str, timestamp: int) <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> key <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>storage:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> timestamp <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>storage[key][<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            l<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>            r<span style="color:#f92672">=</span>len(self<span style="color:#f92672">.</span>storage[key])<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span>(l<span style="color:#f92672">&lt;=</span>r):
</span></span><span style="display:flex;"><span>                mid <span style="color:#f92672">=</span> (l <span style="color:#f92672">+</span> r) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>storage[key][mid][<span style="color:#ae81ff">0</span>]<span style="color:#f92672">&gt;</span>timestamp:
</span></span><span style="display:flex;"><span>                    r<span style="color:#f92672">=</span>mid<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">elif</span> self<span style="color:#f92672">.</span>storage[key][mid][<span style="color:#ae81ff">0</span>]<span style="color:#f92672">&lt;</span>timestamp:
</span></span><span style="display:flex;"><span>                    l<span style="color:#f92672">=</span>mid<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>storage[key][mid][<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>storage[key][r][<span style="color:#ae81ff">1</span>]
</span></span></code></pre></div>
        
    </div>

    <div class="prev-next">
        
    </div>

    
    
    <svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="topFunction()" title="Go to top">
        
        <path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/>
    </svg>
    <script>
        let backToTopButton = document.getElementById("btt-button");

        window.onscroll = function() {
            scrollFunction()
        };

        function scrollFunction() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                backToTopButton.style.display = "block";
            } else {
                backToTopButton.style.display = "none";
            }
        }

        function topFunction() {
            smoothScrollToTop();
        }

        function smoothScrollToTop() {
            const scrollToTop = () => {
                const c = document.documentElement.scrollTop || document.body.scrollTop;
                if (c > 0) {
                    window.requestAnimationFrame(scrollToTop);
                    window.scrollTo(0, c - c / 8);
                }
            };
            scrollToTop();
        }
    </script>
    
    
</div>



    
</main><footer class="footer">
    
     
    <span>&copy; 2025 Denis Razsolkov</span>
    
    <span>
        Made using
        <a target="_blank" href="https://github.com/526avijitgupta/gokarna"
            >Gokarna</a
        >
    </span>
</footer>
</body>
</html>
